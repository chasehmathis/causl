<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plasmode Simulation • causl</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Plasmode Simulation">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">causl</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.10.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AMR-Comparison.html">Illustrating Estimator AMR</a>
    </li>
    <li>
      <a href="../articles/Comparison.html">Comparison of Methods</a>
    </li>
    <li>
      <a href="../articles/CopulaSimulation.html">Copula Simulation</a>
    </li>
    <li>
      <a href="../articles/CustomFamilies.html">Custom Families</a>
    </li>
    <li>
      <a href="../articles/Discrete_Variables_Copula.html">Discrete Variables Copula</a>
    </li>
    <li>
      <a href="../articles/Families.html">Families, link functions and parameters</a>
    </li>
    <li>
      <a href="../articles/Hidden_Variables.html">Hidden Variables</a>
    </li>
    <li>
      <a href="../articles/HTEs.html">Heterogeneous TEs</a>
    </li>
    <li>
      <a href="../articles/Inversion.html">Inversion Tutorial</a>
    </li>
    <li>
      <a href="../articles/Plasmode.html">Plasmode Simulation</a>
    </li>
    <li>
      <a href="../articles/PowerCalculations.html">Inversion Tutorial</a>
    </li>
    <li>
      <a href="../articles/Simple-Copula-Parametrization.html">Specifying Copula Models through Correlation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Plasmode Simulation</h1>
                        <h4 data-toc-skip class="author">Robin
Evans</h4>
            
            <h4 data-toc-skip class="date">2025-08-26</h4>
      

      <div class="hidden name"><code>Plasmode.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document describes how to use the <code>causl</code> package to
perform plasmode simulation; that is, producing datasets that combining
real covariates (and possibly treatments) with synthetic outcomes. This
enables us to have realistic datasets, but also to have knowledge of the
underlying causal effect, making them very useful for testing the
relative effectiveness of different inference methods.</p>
<p>Start by loading the <code>causl</code> and <code>dplyr</code>
packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">causl</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h2>
<p>We will use the dataset from a competition held at the Atlantic
Causal Inference Conference in 2016. To obtain this, first run the
following commands:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"vdorie/aciccomp/2016"</span><span class="op">)</span></span></code></pre></div>
<p>Then load the <code>aciccomp2016</code> package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">aciccomp2016</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">input_2016</span><span class="op">)</span><span class="op">)</span> <span class="co"># show 10 rows of first few variables</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4,802 × 58</span></span></span>
<span><span class="co">##      x_1 x_2     x_3   x_4   x_5   x_6   x_7   x_8   x_9  x_10  x_11  x_12  x_13</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>    29 C         1     7    60    85     0     0     1     0     0     1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>    27 C         0     0    64   178     0     0     0     0     0     2     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>    27 C         0     0    60   102     0     0     0     0     0     1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>    37 C         0     0    65   174     0     0     0     0     0     1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>    24 C        20    14    63   129     0     0     0     0     0     1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>    27 C        40    15    63   135     0     0     0     0     0     1     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>    26 C        20     8    69   140     0     0     0     1     0     0     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>    33 C         0     0    60   110     0     0     0     1     0     0     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>    28 C         3     5    61   160     0     0     0     0     0     3     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>    31 C         0     0    63   114     0     1     0     0     0     0     0</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 4,792 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 45 more variables: x_14 &lt;int&gt;, x_15 &lt;int&gt;, x_16 &lt;int&gt;, x_17 &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   x_18 &lt;int&gt;, x_19 &lt;int&gt;, x_20 &lt;int&gt;, x_21 &lt;fct&gt;, x_22 &lt;int&gt;, x_23 &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   x_24 &lt;fct&gt;, x_25 &lt;int&gt;, x_26 &lt;int&gt;, x_27 &lt;int&gt;, x_28 &lt;int&gt;, x_29 &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   x_30 &lt;int&gt;, x_31 &lt;int&gt;, x_32 &lt;int&gt;, x_33 &lt;int&gt;, x_34 &lt;int&gt;, x_35 &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   x_36 &lt;int&gt;, x_37 &lt;int&gt;, x_38 &lt;int&gt;, x_39 &lt;int&gt;, x_40 &lt;int&gt;, x_41 &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   x_42 &lt;int&gt;, x_43 &lt;int&gt;, x_44 &lt;int&gt;, x_45 &lt;int&gt;, x_46 &lt;int&gt;, x_47 &lt;int&gt;, …</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h2>
<p>Let us consider a model for the causal effect of smoking on
birthweight. We will start with a binary variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
to indicate whether the mother smoked during the pregnancy, and later
extend this to a zero-inflated continuous variable. We start by setting
up the model inputs:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">A</span> <span class="op">~</span> <span class="va">x_1</span> <span class="op">+</span> <span class="va">x_3</span> <span class="op">+</span> <span class="va">x_4</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">A</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># fams &lt;- list(integer(0), 5, 1, 1)</span></span>
<span><span class="va">fams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, <span class="st">"binomial"</span>, <span class="st">"gaussian"</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>,<span class="fl">0.03</span>,<span class="fl">0.02</span>,<span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3200</span>, <span class="op">-</span><span class="fl">500</span><span class="op">)</span>, phi<span class="op">=</span><span class="fl">400</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>             cop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta<span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then call <code>rfrugalParam</code> to simulate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>   <span class="co"># to obtain consistent results</span></span>
<span><span class="va">datAY</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfrugal.html">rfrugalParam</a></span><span class="op">(</span>formulas<span class="op">=</span><span class="va">forms</span>, family<span class="op">=</span><span class="va">fams</span>, pars<span class="op">=</span><span class="va">pars</span>, dat<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Inversion method selected: using pair-copula parameterization</span></span></code></pre>
<p>We can now check that this basic simulation was performed correctly.
First we fit the treatment variable using the correct model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glmA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">A</span> <span class="op">~</span> <span class="va">x_1</span> <span class="op">+</span> <span class="va">x_3</span> <span class="op">+</span> <span class="va">x_4</span>, family<span class="op">=</span><span class="va">binomial</span>, data<span class="op">=</span><span class="va">datAY</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">glmA</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span></span></code></pre></div>
<pre><code><span><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)  -1.4378    0.14246  -10.09 5.97e-24</span></span>
<span><span class="co">## x_1           0.0292    0.00577    5.06 4.09e-07</span></span>
<span><span class="co">## x_3           0.0196    0.00360    5.44 5.22e-08</span></span>
<span><span class="co">## x_4           0.0423    0.00716    5.91 3.46e-09</span></span></code></pre>
<p>Indeed, the parameters appear correct. Then we can use inverse
probability weighting (IPW) to estimate the parameters for the outcome
model. We will need to load the <code>survey</code> package to get
robust standard errors after the weighting.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">glmA</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">wt</span> <span class="op">&lt;-</span> <span class="va">datAY</span><span class="op">$</span><span class="va">A</span><span class="op">/</span><span class="va">ps</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">datAY</span><span class="op">$</span><span class="va">A</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">ps</span><span class="op">)</span></span>
<span><span class="va">glmY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyglm.html" class="external-link">svyglm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">A</span>, design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span>, weights <span class="op">=</span> <span class="va">wt</span>, data<span class="op">=</span><span class="va">datAY</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">glmY</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span></span></code></pre></div>
<pre><code><span><span class="co">##             Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span><span class="co">## (Intercept)     3205        8.4   381.6        0</span></span>
<span><span class="co">## A               -520       12.3   -42.3        0</span></span></code></pre>
<p>We can also compare with a naïve method that ignores reweighting.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glmYn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">A</span>, data<span class="op">=</span><span class="va">datAY</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">glmYn</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span></span></code></pre></div>
<pre><code><span><span class="co">##             Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span><span class="co">## (Intercept)     3257       7.37   442.2        0</span></span>
<span><span class="co">## A               -640      11.42   -56.1        0</span></span></code></pre>
<div class="section level3">
<h3 id="automatic-parameter-generation">Automatic parameter generation<a class="anchor" aria-label="anchor" href="#automatic-parameter-generation"></a>
</h3>
<p>We can also use the function <code><a href="../reference/gen_cop_pars.html">gen_cop_pars()</a></code> to sample
parameters for the copula, rather than having to specify a vector for
every bivariate copula. To do this, we simply provide the list of
formulas, the dataset, and a range that we would like the (partial)
correlations to ultimately fall into.</p>
<p>For example, if we want the correlations in the range
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mn>0.5</mn><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(-0.5,0)</annotation></semantics></math>,
we can call</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars2</span> <span class="op">&lt;-</span> <span class="va">pars</span></span>
<span><span class="va">pars2</span><span class="op">$</span><span class="va">cop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_cop_pars.html">gen_cop_pars</a></span><span class="op">(</span>formulas <span class="op">=</span> <span class="va">forms</span>, data<span class="op">=</span><span class="va">dat</span>, range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This method gives (partial) correlations -0.078, -0.143, and
0.095.</p>
<p>We can then simulate using this set of parameters.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">124</span><span class="op">)</span></span>
<span><span class="va">datAY2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfrugal.html">rfrugalParam</a></span><span class="op">(</span>formulas<span class="op">=</span><span class="va">forms</span>, family<span class="op">=</span><span class="va">fams</span>, pars<span class="op">=</span><span class="va">pars2</span>, dat<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Inversion method selected: using pair-copula parameterization</span></span></code></pre>
<p>We can check the parameters in the same manner as above, and indeed
we obtain an intercept of 3194 (se
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>=</mo><annotation encoding="application/x-tex">=</annotation></semantics></math>
7.9) and a causal effect of -496.8 (12).</p>
<p>We can also use a more complicated method for generating copula
parameters. Suppose we want these to depend upon <code>x_2</code>, which
is a factor with six levels. Then we specify</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forms3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">A</span> <span class="op">~</span> <span class="va">x_1</span> <span class="op">+</span> <span class="va">x_3</span> <span class="op">+</span> <span class="va">x_4</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">A</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span> <span class="va">x_2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>and simulate as:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">125</span><span class="op">)</span></span>
<span><span class="va">pars3</span> <span class="op">&lt;-</span> <span class="va">pars</span></span>
<span><span class="va">pars3</span><span class="op">$</span><span class="va">cop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_cop_pars.html">gen_cop_pars</a></span><span class="op">(</span>formulas <span class="op">=</span> <span class="va">forms3</span>, data<span class="op">=</span><span class="va">dat</span>, range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">datAY3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfrugal.html">rfrugalParam</a></span><span class="op">(</span>formulas<span class="op">=</span><span class="va">forms3</span>, family<span class="op">=</span><span class="va">fams</span>, pars<span class="op">=</span><span class="va">pars3</span>, dat<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Inversion method selected: using pair-copula parameterization</span></span></code></pre>
<p>This time we obtain an intercept of 3199 (8.5) and a causal effect of
-489.1 (12.4). In this case the copula parameter is a vector of six
entries; for example for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>-<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mn>1</mn></msub><annotation encoding="application/x-tex">X_1</annotation></semantics></math>
effect this is (-1.47, -0.01, 0.04, 0, 0.01, -0.05).</p>
</div>
</div>
<div class="section level2">
<h2 id="other-copula-families">Other copula families<a class="anchor" aria-label="anchor" href="#other-copula-families"></a>
</h2>
<p>Until now we have only used Gaussian copulas, but we can easily
specify a different family. For example, suppose we wish to consider
Student t-copulas. In this case we need to choose a degrees of freedom
parameter, though this is easily managed with
<code><a href="../reference/gen_cop_pars.html">gen_cop_pars()</a></code> which allows additional arguments as
<code>...</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">126</span><span class="op">)</span></span>
<span><span class="va">pars4</span> <span class="op">&lt;-</span> <span class="va">pars3</span></span>
<span><span class="op">(</span><span class="va">pars4</span><span class="op">$</span><span class="va">cop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_cop_pars.html">gen_cop_pars</a></span><span class="op">(</span><span class="va">forms3</span>, data<span class="op">=</span><span class="va">dat</span>, range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span>, par2<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $Y</span></span>
<span><span class="co">## $Y$x_1</span></span>
<span><span class="co">## $Y$x_1$beta</span></span>
<span><span class="co">## [1] -1.49492  0.00826 -0.01525  0.01971 -0.01109 -0.00152</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y$x_1$par2</span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y$x_3</span></span>
<span><span class="co">## $Y$x_3$beta</span></span>
<span><span class="co">## [1] -1.51246  0.01611 -0.01106 -0.00215 -0.01853  0.02195</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y$x_3$par2</span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y$x_4</span></span>
<span><span class="co">## $Y$x_4$beta</span></span>
<span><span class="co">## [1] -1.517160  0.000418 -0.004662 -0.021514 -0.002447 -0.010080</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y$x_4$par2</span></span>
<span><span class="co">## [1] 4</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fams4</span> <span class="op">&lt;-</span> <span class="va">fams</span></span>
<span><span class="va">fams4</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">datAY4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfrugal.html">rfrugalParam</a></span><span class="op">(</span>formulas<span class="op">=</span><span class="va">forms3</span>, family<span class="op">=</span><span class="va">fams4</span>, pars<span class="op">=</span><span class="va">pars4</span>, dat<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Inversion method selected: using pair-copula parameterization</span></span></code></pre>
<p>Now the estimates are 3218 (8.5) and a causal effect of -498.1
(12.3).</p>
</div>
<div class="section level2">
<h2 id="strength-of-relationships">Strength of relationships<a class="anchor" aria-label="anchor" href="#strength-of-relationships"></a>
</h2>
<p>We also introduce the function <code><a href="../reference/adj_vars.html">adj_vars()</a></code>, which allows
users to modify the strength of the partial correlations (or other
parameters) by scaling the parameters of the linear predictor. The
argument <code>factor</code> can be modified to control the strength of
the <code>strong</code> and <code>weak</code> variables respectively;
the default values are 5 and 0.2. Returning to the example above,
suppose that we want <code>x_4</code> to be much more closely related
than <code>x_1</code> or <code>x_3</code>. Then we can apply:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">127</span><span class="op">)</span></span>
<span><span class="va">pars5</span> <span class="op">&lt;-</span> <span class="va">pars3</span></span>
<span><span class="va">pars_tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_cop_pars.html">gen_cop_pars</a></span><span class="op">(</span><span class="va">forms3</span>, data<span class="op">=</span><span class="va">dat</span>, range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.25</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">pars5</span><span class="op">$</span><span class="va">cop</span> <span class="op">&lt;-</span> <span class="fu">causl</span><span class="fu">:::</span><span class="fu"><a href="../reference/adj_vars.html">adj_vars</a></span><span class="op">(</span><span class="va">pars_tmp</span>, strong<span class="op">=</span><span class="st">"x_4"</span>, weak<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x_1"</span>,<span class="st">"x_3"</span><span class="op">)</span>, factor<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">0.25</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $Y</span></span>
<span><span class="co">## $Y$x_1</span></span>
<span><span class="co">## $Y$x_1$beta</span></span>
<span><span class="co">## [1] -3.16e-01 -2.12e-03 -1.29e-03  4.74e-06  2.13e-03  2.60e-03</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y$x_3</span></span>
<span><span class="co">## $Y$x_3$beta</span></span>
<span><span class="co">## [1] -0.308757 -0.000327  0.001470  0.000348 -0.000276  0.001578</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y$x_4</span></span>
<span><span class="co">## $Y$x_4$beta</span></span>
<span><span class="co">## [1] -2.500827 -0.005808 -0.002827  0.017982 -0.000621 -0.015468</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fams5</span> <span class="op">&lt;-</span> <span class="va">fams</span></span>
<span><span class="va">fams5</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span>  <span class="co"># use Frank copula</span></span>
<span><span class="va">datAY5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfrugal.html">rfrugalParam</a></span><span class="op">(</span>formulas<span class="op">=</span><span class="va">forms3</span>, family<span class="op">=</span><span class="va">fams5</span>, pars<span class="op">=</span><span class="va">pars5</span>, dat<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Inversion method selected: using pair-copula parameterization</span></span></code></pre>
<p>This time the estimates are 3202 (8.1) and a causal effect of -500.5
(12.4).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Robin Evans, Xi Lin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
